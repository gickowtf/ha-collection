blueprint:
  name: ğŸš¶â€â™‚ï¸ğŸ’¡ Bewegungsmelder AuÃŸenlicht
  description:  |
    <h3>ğŸŒŸ Features</h3>

    <ul>
      <li>ğŸš¶â€â™‚ï¸ <b>Bewegungsgesteuertes Licht</b> mit Helligkeits- und Zeitsteuerung</li>
      <li>ğŸŒ <b>TagsÃ¼ber (30 Min nach Sonnenaufgang)</b> â†’ ğŸš« Kein Licht durch Bewegung</li>
      <li>ğŸŒ™ <b>Vor 22 Uhr</b> â†’ ğŸ”† 100% Helligkeit bei Bewegung, ğŸŒ™ 20% bei keiner Bewegung</li>
      <li>ğŸ•™ <b>Nach 22 Uhr</b> â†’ ğŸ”… 50% Helligkeit bei Bewegung, â›” Licht aus ohne Bewegung</li>
      <li>â³ <b>30 Min nach Sonnenuntergang</b> â†’ ğŸŒ™ Licht auf 20%</li>
      <li>ğŸ“Š <b>Helligkeitssensor (Lux-Wert) anpassbar</b></li>
    </ul>

    <hr>

    <h3>ğŸ”„ Changelog</h3>

    <ul>
      <li><b>1.0</b> â†’ Erste Version mit vollstÃ¤ndiger Steuerung fÃ¼r Bewegung, Helligkeit & Tageszeiten</li>
    </ul>
  domain: automation
  input:
    motion_sensor:
      name: ğŸš¶â€â™‚ï¸ Bewegungsmelder
      description: ğŸ¯ Der Bewegungsmelder, der das Licht steuert.
      selector:
        entity:
          domain: binary_sensor
          device_class: motion
    light_target:
      name: ğŸ’¡ AuÃŸenlicht
      description: ğŸ¡ Das Licht, das bei Bewegung geschaltet werden soll.
      selector:
        entity:
          domain: light
    illuminance_sensor:
      name: ğŸŒ Helligkeitssensor
      description: ğŸ“Š Sensor fÃ¼r die Umgebungshelligkeit (Lux-Wert).
      selector:
        entity:
          domain: sensor
          device_class: illuminance
    illuminance_threshold:
      name: ğŸ”† Helligkeitsgrenze (Lux)
      description: â³ **Wert, unter dem das Licht aktiviert wird.**  
      default: 600
      selector:
        number:
          min: 0
          max: 5000
          step: 10
          unit_of_measurement: "lx"



mode: single
trigger:
  - platform: state
    entity_id: !input motion_sensor
    from: "off"
    to: "on"
    id: Bewegung_erkannt

  - platform: state
    entity_id: !input motion_sensor
    from: "on"
    to: "off"
    id: Keine_Bewegung
    for:
      hours: 0
      minutes: 0
      seconds: 30

  - platform: sun
    event: sunrise
    offset: "00:30:00"
    id: Tagmodus_an

  - platform: sun
    event: sunset
    offset: "00:30:00"
    id: Nachtmodus_an

  - platform: time
    at: "22:00:00"
    id: Licht_aus_22uhr

action:
  - choose:
      # TagsÃ¼ber (30 Min nach Sonnenaufgang) â†’ Licht aus & Bewegung deaktivieren
      - conditions:
          - condition: trigger
            id: Tagmodus_an
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input light_target

      # Bewegung erkannt â†’ Licht an (nur wenn es dunkel genug ist)
      - conditions:
          - condition: trigger
            id: Bewegung_erkannt
          - condition: numeric_state
            entity_id: !input illuminance_sensor
            below: !input illuminance_threshold
          - condition: sun
            before: sunrise
            before_offset: "-00:30:00"
            after: sunset
            after_offset: "00:30:00"
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input light_target
            data:
              brightness_pct: 100

      - conditions:
          - condition: trigger
            id: Bewegung_erkannt
          - condition: numeric_state
            entity_id: !input illuminance_sensor
            below: !input illuminance_threshold
          - condition: time
            after: "22:00:00"
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input light_target
            data:
              brightness_pct: 50

      # Keine Bewegung mehr â†’ Licht auf 20% (vor 22 Uhr)
      - conditions:
          - condition: trigger
            id: Keine_Bewegung
          - condition: numeric_state
            entity_id: !input illuminance_sensor
            below: !input illuminance_threshold
          - condition: sun
            after: sunset
            after_offset: "00:30:00"
          - condition: time
            before: "22:00:00"
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input light_target
            data:
              brightness_pct: 20

      # Keine Bewegung mehr â†’ Licht aus nach 22 Uhr
      - conditions:
          - condition: trigger
            id: Keine_Bewegung
          - condition: time
            after: "22:00:00"
        sequence:
          - service: light.turn_off
            target:
              entity_id: !input light_target

      # 30 Min nach Sonnenuntergang â†’ Licht auf 20%, falls es vorher aus war
      - conditions:
          - condition: trigger
            id: Nachtmodus_an
          - condition: numeric_state
            entity_id: !input illuminance_sensor
            below: !input illuminance_threshold
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input light_target
            data:
              brightness_pct: 20
